---
title: O modelo de provedor do Entity Framework 6 - EF6
author: divega
ms.date: 2018-06-27
ms.assetid: 066832F0-D51B-4655-8BE7-C983C557E0E4
ms.openlocfilehash: 7d9e2f49b9ef59fb63b024646911ec0d8dfcfc60
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251096"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="a2f7a-102">O modelo de provedor do Entity Framework 6</span><span class="sxs-lookup"><span data-stu-id="a2f7a-102">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="a2f7a-103">O modelo de provedor do Entity Framework permite que o Entity Framework a ser usado com diferentes tipos de servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-103">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="a2f7a-104">Por exemplo, um provedor pode estar conectado para permitir que o EF seja usado contra o Microsoft SQL Server, enquanto outro provedor pode ser conectado para permitir que o EF seja usado contra o Microsoft SQL Server Compact Edition.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-104">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="a2f7a-105">Os provedores para o EF6 que estamos cientes de que podem ser encontrados na [provedores de Entity Framework](~/ef6/fundamentals/providers/index.md) página.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-105">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](~/ef6/fundamentals/providers/index.md) page.</span></span>

<span data-ttu-id="a2f7a-106">Determinadas alterações eram necessárias para a maneira como o EF interage com provedores para permitir que o EF ser liberadas sob uma licença de software livre.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-106">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="a2f7a-107">Essas alterações requerem a recriação dos provedores do EF nos assemblies do EF6, junto com novos mecanismos para o registro do provedor.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-107">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="a2f7a-108">Recompilar</span><span class="sxs-lookup"><span data-stu-id="a2f7a-108">Rebuilding</span></span>

<span data-ttu-id="a2f7a-109">Com o EF6 do código-fonte que antes fazia parte do .NET Framework agora é fornecido como assemblies do fora de banda (OOB).</span><span class="sxs-lookup"><span data-stu-id="a2f7a-109">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="a2f7a-110">Detalhes sobre como criar aplicativos em relação ao EF6 podem ser encontrados na [atualização de aplicativos para o EF6](~/ef6/what-is-new/upgrading-to-ef6.md) página.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-110">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span></span> <span data-ttu-id="a2f7a-111">Provedores também precisará ser recriado usando estas instruções.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-111">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="a2f7a-112">Visão geral dos tipos de provedor</span><span class="sxs-lookup"><span data-stu-id="a2f7a-112">Provider types overview</span></span>

<span data-ttu-id="a2f7a-113">Um provedor do EF realmente é uma coleção de serviços específicos do provedor definidas por tipos CLR que esses serviços estendidos de (para uma classe base) ou implementam (para uma interface).</span><span class="sxs-lookup"><span data-stu-id="a2f7a-113">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="a2f7a-114">Dois desses serviços são fundamentais e necessárias para o EF funcionar em todos os.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-114">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="a2f7a-115">Outros são opcionais e só precisam ser implementados se uma funcionalidade específica é necessária e/ou as implementações padrão desses serviços não funciona para o servidor de banco de dados específico que está sendo direcionado.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-115">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

## <a name="fundamental-provider-types"></a><span data-ttu-id="a2f7a-116">Tipos fundamentais do provedor</span><span class="sxs-lookup"><span data-stu-id="a2f7a-116">Fundamental provider types</span></span>

### <a name="dbproviderfactory"></a><span data-ttu-id="a2f7a-117">DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="a2f7a-117">DbProviderFactory</span></span>

<span data-ttu-id="a2f7a-118">O EF depende da presença de um tipo derivado [DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) para executar todo o acesso de baixo nível do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-118">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="a2f7a-119">DbProviderFactory não é parte do EF, mas em vez disso, é uma classe no .NET Framework que serve um ponto de entrada para os provedores ADO.NET que pode ser usada pelo EF, outro O/RMs, ou diretamente por um aplicativo para obter as instâncias de conexões, comandos, parâmetros e outras abstrações ADO.NET em um provedor de maneira independente.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-119">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="a2f7a-120">Para obter mais informações sobre o DbProviderFactory um ser encontrado na [documentação do MSDN para o ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2f7a-120">More information about DbProviderFactory an be found in the [MSDN documentation for ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span></span>

### <a name="dbproviderservices"></a><span data-ttu-id="a2f7a-121">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="a2f7a-121">DbProviderServices</span></span>

<span data-ttu-id="a2f7a-122">O EF depende da presença de um tipo derivado de DbProviderServices para fornecer funcionalidade adicional necessária pelo EF sobre a funcionalidade já fornecida pelo provedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-122">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="a2f7a-123">Em versões anteriores do EF, a classe de DbProviderServices fazia parte do .NET Framework e foi encontrada no namespace Common.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-123">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="a2f7a-124">Começando com o EF6 esta classe agora é parte do EntityFramework e está no namespace System.Data.Entity.Core.Common.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-124">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="a2f7a-125">Mais detalhes sobre a funcionalidade fundamental de uma implementação de DbProviderServices podem ser encontrados em [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span><span class="sxs-lookup"><span data-stu-id="a2f7a-125">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span></span> <span data-ttu-id="a2f7a-126">No entanto, observe que a partir da hora de escrever essa informação não é atualizado para o EF6 Embora a maioria dos conceitos ainda é válidas.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-126">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="a2f7a-127">As implementações do SQL Server e SQL Server Compact de DbProviderServices também são verificadas para o [base de código do código-fonte aberto](https://github.com/aspnet/EntityFramework6/) e pode servir como referências úteis para outras implementações.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-127">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://github.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="a2f7a-128">Em versões anteriores do EF para usar a implementação de DbProviderServices foi obtida diretamente de um provedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-128">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="a2f7a-129">Isso foi feito convertendo DbProviderFactory para IServiceProvider e chamando o método GetService.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-129">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="a2f7a-130">Esse acoplamento rígido o provedor do EF com o DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-130">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="a2f7a-131">Esse acoplamento bloqueado EF que estão sendo movidos para fora do .NET Framework e, portanto, para o EF6 esse acoplamento rígido foi removido e uma implementação de DbProviderServices agora é registrada diretamente no arquivo de configuração do aplicativo ou em baseado em código configuração, conforme descrito mais detalhadamente os _DbProviderServices registrando_ seção abaixo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-131">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

## <a name="additional-services"></a><span data-ttu-id="a2f7a-132">Serviços adicionais</span><span class="sxs-lookup"><span data-stu-id="a2f7a-132">Additional services</span></span>

<span data-ttu-id="a2f7a-133">Além dos serviços de fundamentais descritos acima também há muitos outros serviços usados pelo EF que são sempre ou, às vezes, específico do provedor.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-133">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="a2f7a-134">Implementações específicas do provedor de padrão desses serviços podem ser fornecidas por uma implementação de DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-134">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="a2f7a-135">Aplicativos também podem substituir as implementações de um desses serviços ou fornecem implementações quando um tipo de DbProviderServices não fornece um padrão.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-135">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="a2f7a-136">Isso é descrito mais detalhadamente a _Resolvendo serviços adicionais_ seção abaixo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-136">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="a2f7a-137">Os tipos de serviço adicional que um provedor pode ser interessante para um provedor estão listados abaixo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-137">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="a2f7a-138">Mais detalhes sobre cada um desses tipos de serviço podem ser encontrados na documentação da API.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-138">More details about each of these service types can be found in the API documentation.</span></span>

### <a name="idbexecutionstrategy"></a><span data-ttu-id="a2f7a-139">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="a2f7a-139">IDbExecutionStrategy</span></span>

<span data-ttu-id="a2f7a-140">Isso é um serviço opcional que permite que um provedor implementar novas tentativas ou outro comportamento quando consultas e comandos são executados no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-140">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="a2f7a-141">Se nenhuma implementação for fornecida, em seguida, EF será simplesmente execute os comandos e propagar todas as exceções geradas.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-141">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="a2f7a-142">Para o SQL Server, esse serviço é usado para fornecer uma política de repetição que é especialmente útil ao executar em servidores de banco de dados baseado em nuvem, como SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-142">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

### <a name="idbconnectionfactory"></a><span data-ttu-id="a2f7a-143">IDbConnectionFactory</span><span class="sxs-lookup"><span data-stu-id="a2f7a-143">IDbConnectionFactory</span></span>

<span data-ttu-id="a2f7a-144">Isso é um serviço opcional que permite que um provedor criar objetos de DbConnection por convenção, quando é fornecido apenas um nome de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-144">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="a2f7a-145">Observe que, embora este serviço pode ser resolvido com uma implementação de DbProviderServices ele presente desde o EF 4.1 e também pode ser definido explicitamente no arquivo de configuração ou no código.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-145">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="a2f7a-146">O provedor só terá uma chance para resolver esse serviço se ele registrado como o provedor padrão (consulte _o provedor padrão_ abaixo) e, se uma fábrica de conexão padrão não foi definida em outro lugar.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-146">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

### <a name="dbspatialservices"></a><span data-ttu-id="a2f7a-147">DbSpatialServices</span><span class="sxs-lookup"><span data-stu-id="a2f7a-147">DbSpatialServices</span></span>

<span data-ttu-id="a2f7a-148">Esse é um serviços opcional que permite que um provedor adicionar suporte para tipos espaciais, geography e geometry.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-148">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="a2f7a-149">Uma implementação desse serviço deve ser fornecida para que um aplicativo para usar o EF com tipos espaciais.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-149">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="a2f7a-150">DbSptialServices é solicitado de duas maneiras.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-150">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="a2f7a-151">Primeiro, específico do provedor de serviços espaciais são solicitados usando um objeto DbProviderInfo (que contém o invariável de token de manifesto e o nome) como chave.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-151">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="a2f7a-152">Em segundo lugar, DbSpatialServices podem ser solicitados sem chave.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-152">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="a2f7a-153">Isso é usado para resolver o "global espacial provedor" que é usado durante a criação de tipos de DbGeography ou DbGeometry autônomos.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-153">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

### <a name="migrationsqlgenerator"></a><span data-ttu-id="a2f7a-154">MigrationSqlGenerator</span><span class="sxs-lookup"><span data-stu-id="a2f7a-154">MigrationSqlGenerator</span></span>

<span data-ttu-id="a2f7a-155">Isso é um serviço opcional que permite migrações do EF ser usado para a geração de SQL usado na criação e modificação de esquemas de banco de dados Code First.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-155">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="a2f7a-156">Uma implementação é necessário para dar suporte a migrações.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-156">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="a2f7a-157">Se uma implementação for fornecida, em seguida, também poderá ser usado quando os bancos de dados são criados usando os inicializadores de banco de dados ou o método Database.Create.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-157">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="a2f7a-158">Func < cadeia de caracteres, HistoryContextFactory DbConnection ></span><span class="sxs-lookup"><span data-stu-id="a2f7a-158">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="a2f7a-159">Isso é um serviço opcional que permite que um provedor configurar o mapeamento do HistoryContext ao `__MigrationHistory` tabela usada pelo migrações do EF.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-159">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="a2f7a-160">O HistoryContext é um código primeiro DbContext e pode ser configurado usando a API fluente normal para alterar coisas como o nome da tabela e as especificações de mapeamento de coluna.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-160">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="a2f7a-161">A implementação padrão desse serviço retornado pelo EF para todos os provedores pode funcionar para um servidor de banco de dados fornecido, se todos os mapeamentos padrão de tabela e coluna têm suporte pelo provedor.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-161">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="a2f7a-162">Nesse caso, o provedor não precisa fornecer uma implementação desse serviço.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-162">In such a case the provider does not need to supply an implementation of this service.</span></span>

### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="a2f7a-163">IDbProviderFactoryResolver</span><span class="sxs-lookup"><span data-stu-id="a2f7a-163">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="a2f7a-164">Isso é um serviço opcional para obter o DbProviderFactory correto de um determinado objeto DbConnection.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-164">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="a2f7a-165">A implementação padrão desse retornado pelo EF para todos os provedores de serviço destina-se a funcionar para todos os provedores.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-165">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="a2f7a-166">No entanto, quando em execução no .NET 4, o DbProviderFactory não é publicamente acessível a partir de um, se seu DbConnections.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-166">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="a2f7a-167">Portanto, o EF usa algumas heurísticas para pesquisar os provedores registrados para localizar uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-167">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="a2f7a-168">É possível que para alguns provedores esses métodos heurísticos falhará e, em tais situações, o provedor deve fornecer uma nova implementação.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-168">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="a2f7a-169">Registrando DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="a2f7a-169">Registering DbProviderServices</span></span>

<span data-ttu-id="a2f7a-170">A implementação de DbProviderServices para usar pode ser registrada no arquivo de configuração (App. config ou Web. config) ou usando a configuração baseada em código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-170">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="a2f7a-171">Em ambos os casos o registro usa o nome do provedor"invariável" como uma chave.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-171">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="a2f7a-172">Isso permite que vários provedores ser registrado e usado em um único aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-172">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="a2f7a-173">O nome invariável usado para registros do EF é o mesmo que o nome invariável usado para cadeias de conexão e o registro do provedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-173">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="a2f7a-174">Por exemplo, para o SQL Server o nome invariável "System.Data.SqlClient" é usado.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-174">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="a2f7a-175">Registro do arquivo de configuração</span><span class="sxs-lookup"><span data-stu-id="a2f7a-175">Config file registration</span></span>

<span data-ttu-id="a2f7a-176">O tipo de DbProviderServices para usar é registrado como um elemento de provedor na lista de provedores da seção entityFramework do arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-176">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="a2f7a-177">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-177">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="a2f7a-178">O _tipo_ cadeia de caracteres deve ser o nome de tipo qualificado pelo assembly de usar a implementação de DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-178">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="a2f7a-179">Registro baseado em código</span><span class="sxs-lookup"><span data-stu-id="a2f7a-179">Code-based registration</span></span>

<span data-ttu-id="a2f7a-180">Começando com o EF6 provedores também pode ser registrado usando o código.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-180">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="a2f7a-181">Isso permite que um provedor do EF ser usado sem qualquer alteração ao arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-181">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="a2f7a-182">Para usar a configuração com base no código de um aplicativo deve criar uma classe DbConfiguration conforme descrito na [documentação de configuração com base em código](http://msdn.com/data/jj680699).</span><span class="sxs-lookup"><span data-stu-id="a2f7a-182">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](http://msdn.com/data/jj680699).</span></span> <span data-ttu-id="a2f7a-183">O construtor da classe DbConfiguration, em seguida, deve chamar SetProviderServices para registrar o provedor do EF.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-183">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="a2f7a-184">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-184">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="a2f7a-185">Determinar os serviços adicionais</span><span class="sxs-lookup"><span data-stu-id="a2f7a-185">Resolving additional services</span></span>

<span data-ttu-id="a2f7a-186">Conforme mencionado acima na _visão geral de tipos de provedor_ seção um DbProviderServices classe também pode ser usada para resolver os serviços adicionais.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-186">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="a2f7a-187">Isso é possível porque DbProviderServices implementa IDbDependencyResolver e cada tipo de DbProviderServices registrado é adicionado como um resolvedor"padrão".</span><span class="sxs-lookup"><span data-stu-id="a2f7a-187">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="a2f7a-188">O mecanismo IDbDpendencyResolver é descrito mais detalhadamente [resolução de dependência](~/ef6/fundamentals/configuring/dependency-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="a2f7a-188">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](~/ef6/fundamentals/configuring/dependency-resolution.md).</span></span> <span data-ttu-id="a2f7a-189">No entanto, não é necessário compreender todos os conceitos nesta especificação para resolver os serviços adicionais em um provedor.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-189">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="a2f7a-190">A maneira mais comum para um provedor resolver os serviços adicionais é chamar DbProviderServices.AddDependencyResolver para cada serviço no construtor da classe DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-190">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="a2f7a-191">Por exemplo, SqlProviderServices (o provedor do EF para o SQL Server) possui código semelhante a este para inicialização:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-191">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="a2f7a-192">Este construtor usa as classes de auxiliar a seguir:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-192">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="a2f7a-193">SingletonDependencyResolver: fornece uma maneira simples de resolver serviços Singleton — ou seja, os serviços para o qual a mesma instância é retornada sempre que GetService é chamada.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-193">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="a2f7a-194">Serviços temporários geralmente são registrados como um alocador singleton que será usado para criar instâncias transitórias sob demanda.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-194">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="a2f7a-195">ExecutionStrategyResolver: um resolvedor específico retornando IExecutionStrategy implementações.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-195">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="a2f7a-196">Em vez de usar DbProviderServices.AddDependencyResolver também é possível substituir DbProviderServices.GetService e resolver os serviços adicionais diretamente.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-196">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="a2f7a-197">Esse método será chamado quando o EF precisa de um serviço definido por um determinado tipo e, em alguns casos, para uma determinada chave.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-197">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="a2f7a-198">O método deve retornar o serviço, se possível, ou retornar um valor nulo a recusa de retornar o serviço e em vez disso, permitir que outra classe para resolvê-lo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-198">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="a2f7a-199">Por exemplo, para resolver o alocador de conexão padrão o código em GetService poderia ser algo assim:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-199">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="a2f7a-200">Ordem de registro</span><span class="sxs-lookup"><span data-stu-id="a2f7a-200">Registration order</span></span>

<span data-ttu-id="a2f7a-201">Quando várias implementações de DbProviderServices são registradas no arquivo de configuração do aplicativo, eles serão adicionados como secundários resolvedores na ordem em que estão listados.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-201">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="a2f7a-202">Uma vez que os resolvedores sempre sejam adicionados à parte superior da cadeia de resolvedor secundário que isso significa que o provedor no final da lista terá uma chance para resolver as dependências antes dos outros.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-202">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="a2f7a-203">(Isso pode parecer um pouco contraintuitivo a princípio, mas faz sentido se você imaginar considerando cada provedor de lista e o empilhamento sobre os provedores existentes.)</span><span class="sxs-lookup"><span data-stu-id="a2f7a-203">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="a2f7a-204">Normalmente, essa ordem não importa porque a maioria dos serviços de provedor são específicas do provedor e com a chave, nome invariável do provedor.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-204">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="a2f7a-205">No entanto, para os serviços que não são criptografadas pelo nome invariável do provedor ou alguma outro específico do provedor chave que o serviço será resolvido com base nesta ordem.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-205">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="a2f7a-206">Por exemplo, se ele não for explicitamente definido diferentemente em algum lugar caso contrário, o alocador de conexão padrão virá do provedor de nível mais alto na cadeia.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-206">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="a2f7a-207">Registros de arquivo de configuração adicionais</span><span class="sxs-lookup"><span data-stu-id="a2f7a-207">Additional config file registrations</span></span>

<span data-ttu-id="a2f7a-208">É possível registrar explicitamente alguns dos serviços adicionais do provedor descritos acima, diretamente no arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-208">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="a2f7a-209">Quando isso for feito o registro no arquivo de configuração será usado em vez de qualquer coisa retornada pelo método GetService da implementação de DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-209">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="a2f7a-210">Registrar o alocador de conexão padrão</span><span class="sxs-lookup"><span data-stu-id="a2f7a-210">Registering the default connection factory</span></span>

<span data-ttu-id="a2f7a-211">Começando com o EF5 pacote EntityFramework NuGet automaticamente registrado no arquivo de configuração a fábrica de conexão do SQL Express ou a fábrica de conexão LocalDb.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-211">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="a2f7a-212">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-212">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="a2f7a-213">O _tipo_ é o nome de tipo qualificado pelo assembly para a fábrica de conexão padrão, que deve implementar IDbConnectionFactory.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-213">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="a2f7a-214">É recomendável que um pacote do NuGet de provedor definido o alocador de conexão padrão dessa forma, quando instalado.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-214">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="a2f7a-215">Ver _pacotes do NuGet para provedores de_ abaixo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-215">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="a2f7a-216">Alterações adicionais do provedor de EF6</span><span class="sxs-lookup"><span data-stu-id="a2f7a-216">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="a2f7a-217">Alterações de provedor espacial</span><span class="sxs-lookup"><span data-stu-id="a2f7a-217">Spatial provider changes</span></span>

<span data-ttu-id="a2f7a-218">Provedores que dão suporte a tipos espaciais agora devem implementar alguns métodos adicionais em classes derivadas de DbSpatialDataReader:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-218">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="a2f7a-219">Também há novas versões assíncronas dos métodos existentes que são recomendados para ser substituída, pois as implementações padrão de delegar para os métodos síncronos e, portanto, não executar de forma assíncrona:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-219">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="a2f7a-220">Suporte nativo para Enumerable</span><span class="sxs-lookup"><span data-stu-id="a2f7a-220">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="a2f7a-221">EF6 apresenta um novo tipo de expressão, DbInExpression, que foi adicionado para solucionar problemas de desempenho em torno do uso de Enumerable em consultas LINQ.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-221">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="a2f7a-222">A classe de DbProviderManifest tem um novo método virtual SupportsInExpression, que é chamado pelo EF para determinar se um provedor manipula o novo tipo de expressão.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-222">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="a2f7a-223">Para compatibilidade com implementações de provedor existente, o método retornará false.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-223">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="a2f7a-224">Para aproveitar essa melhoria, um provedor de EF6 pode adicionar código para lidar com DbInExpression e substituir SupportsInExpression retornar true.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-224">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="a2f7a-225">Uma instância de DbInExpression pode ser criada chamando o método DbExpressionBuilder.In.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-225">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="a2f7a-226">Uma instância de DbInExpression é composta de uma DbExpression, normalmente, que representa uma coluna de tabela e uma lista de DbConstantExpression para testar uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-226">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="a2f7a-227">Pacotes do NuGet para provedores</span><span class="sxs-lookup"><span data-stu-id="a2f7a-227">NuGet packages for providers</span></span>

<span data-ttu-id="a2f7a-228">É uma maneira de disponibilizar um provedor de EF6 para liberá-lo como um pacote do NuGet.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-228">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="a2f7a-229">Usar um pacote do NuGet tem as seguintes vantagens:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-229">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="a2f7a-230">É fácil de usar NuGet para adicionar o registro do provedor ao arquivo de configuração do aplicativo</span><span class="sxs-lookup"><span data-stu-id="a2f7a-230">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="a2f7a-231">Alterações adicionais podem ser feitas ao arquivo de configuração para definir a fábrica de conexão padrão para que as conexões feitas por convenção, use o provedor registrado</span><span class="sxs-lookup"><span data-stu-id="a2f7a-231">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="a2f7a-232">O NuGet trata a adicionar redirecionamentos de associação para que o provedor do EF6 deve continuar a funcionar mesmo após o lançamento de um novo pacote do EF</span><span class="sxs-lookup"><span data-stu-id="a2f7a-232">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="a2f7a-233">Um exemplo disso é o que está incluído no pacote de EntityFramework.SqlServerCompact a [livre codebase](http://github.com/aspnet/entityframework6).</span><span class="sxs-lookup"><span data-stu-id="a2f7a-233">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](http://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="a2f7a-234">Esse pacote fornece um bom modelo para a criação de pacotes do NuGet de provedor do EF.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-234">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="a2f7a-235">Comandos do PowerShell</span><span class="sxs-lookup"><span data-stu-id="a2f7a-235">PowerShell commands</span></span>

<span data-ttu-id="a2f7a-236">Quando o pacote EntityFramework NuGet está instalado, ele registra um módulo do PowerShell que contém os dois comandos que são muito úteis para pacotes de provedor:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-236">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="a2f7a-237">EFProvider adicionar adiciona uma nova entidade para o provedor no arquivo de configuração do projeto de destino e torna-se de que ele está no final da lista de provedores registrados.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-237">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="a2f7a-238">Adicionar-EFDefaultConnectionFactory adiciona ou atualiza o registro de defaultConnectionFactory no arquivo de configuração do projeto de destino.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-238">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="a2f7a-239">Os dois desses comandos cuidam de adicionar uma seção entityFramework ao arquivo de configuração e adicionar uma coleção de provedores, se necessário.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-239">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="a2f7a-240">Ele destina-se que esses comandos ser chamado do script de NuGet install.ps1.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-240">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="a2f7a-241">Por exemplo, install.ps1 para o provedor SQL Compact é semelhante a este:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-241">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="a2f7a-242">Mais informações sobre esses comandos podem ser obtidas usando get-help na janela do Console do Gerenciador de pacotes.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-242">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="a2f7a-243">Provedores de encapsulamento</span><span class="sxs-lookup"><span data-stu-id="a2f7a-243">Wrapping providers</span></span>

<span data-ttu-id="a2f7a-244">Um provedor de encapsulamento é um provedor do EF e/ou ADO.NET que encapsula um provedor existente para estendê-lo com outras funcionalidades como criação de perfil ou capacidades de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-244">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="a2f7a-245">Encapsulamento provedores pode ser registrado da maneira normal, mas geralmente é mais conveniente para configurar o provedor de encapsulamento em tempo de execução interceptando a resolução de serviços relacionados ao provedor.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-245">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="a2f7a-246">O evento estático OnLockingConfiguration na classe DbConfiguration pode ser usado para fazer isso.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-246">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="a2f7a-247">OnLockingConfiguration é chamado depois que o EF determinou onde todas as configurações do EF para o domínio de aplicativo serão obtidas a partir, mas antes que seja bloqueado para uso.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-247">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="a2f7a-248">Na inicialização do aplicativo (antes do EF é usado), o aplicativo deve registrar um manipulador de eventos para este evento.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-248">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="a2f7a-249">(Estamos considerando a adição de suporte para registrar esse manipulador no arquivo de configuração, mas isso ainda não é suportado.) O manipulador de eventos, em seguida, deve fazer uma chamada para replaceservice tenha para cada serviço que precisa ser encapsulado.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-249">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="a2f7a-250">Por exemplo, para encapsular IDbConnectionFactory e DbProviderService, deve ser registrado um manipulador de algo assim:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-250">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="a2f7a-251">O serviço que foi resolvido e agora deve ser encapsulado juntamente com a chave que foi usada para resolver o serviço são passados para o manipulador.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-251">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="a2f7a-252">O manipulador pode encapsular esse serviço e substitua o serviço retornado com a versão encapsulada.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-252">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="a2f7a-253">Resolvendo um DbProviderFactory com o EF</span><span class="sxs-lookup"><span data-stu-id="a2f7a-253">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="a2f7a-254">DbProviderFactory é um dos tipos fundamentais do provedor necessários pelo EF, conforme descrito na _visão geral de tipos de provedor_ seção acima.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-254">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="a2f7a-255">Como já mencionado, não é um tipo EF e registro geralmente não é parte da configuração do EF, mas em vez disso, é o registro do provedor ADO.NET normal no arquivo Machine. config e/ou o arquivo de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-255">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="a2f7a-256">Apesar deste EF ainda usa seu mecanismo de resolução de dependência normal durante a procura de um DbProviderFactory para usar.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-256">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="a2f7a-257">O resolvedor padrão usa o registro do ADO.NET normal nos arquivos de configuração de modo que é normalmente transparente.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-257">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="a2f7a-258">Devido à resolução de dependência normal mecanismo é usado, mas isso significa que um IDbDependencyResolver pode ser usado para resolver um DbProviderFactory mesmo quando o registro do ADO.NET normal não foi feito.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-258">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="a2f7a-259">Resolver DbProviderFactory dessa maneira tem várias implicações:</span><span class="sxs-lookup"><span data-stu-id="a2f7a-259">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="a2f7a-260">Um aplicativo usando a configuração baseada em código pode adicionar chamadas em sua classe DbConfiguration para registrar o DbProviderFactory apropriado.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-260">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="a2f7a-261">Isso é especialmente útil para aplicativos que não desejam (ou não podem) fazer uso de qualquer configuração baseada em arquivo em todos os.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-261">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="a2f7a-262">O serviço pode ser encapsulado ou substituído usando replaceservice tenha conforme descrito na _provedores de encapsulamento_ seção acima</span><span class="sxs-lookup"><span data-stu-id="a2f7a-262">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="a2f7a-263">Teoricamente, uma implementação de DbProviderServices foi possível resolver um DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-263">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="a2f7a-264">O ponto importante a observar sobre como fazer qualquer uma dessas coisas é que eles só afetará a pesquisa de DbProviderFactory pelo EF.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-264">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="a2f7a-265">Outro código não são do EF ainda pode esperar que o provedor ADO.NET a ser registrado da maneira normal e poderá falhar se o registro não foi encontrado.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-265">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="a2f7a-266">Por esse motivo, é normalmente melhor para um DbProviderFactory ser registrado da maneira normal do ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-266">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="a2f7a-267">Serviços relacionados</span><span class="sxs-lookup"><span data-stu-id="a2f7a-267">Related services</span></span>

<span data-ttu-id="a2f7a-268">Se o EF é usado para resolver um DbProviderFactory, em seguida, ele também deve resolver os serviços IProviderInvariantName e IDbProviderFactoryResolver.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-268">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="a2f7a-269">IProviderInvariantName é um serviço que é usado para determinar um nome invariável do provedor para um determinado tipo de DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-269">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="a2f7a-270">A implementação padrão desse serviço usa o registro do provedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-270">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="a2f7a-271">Isso significa que se o provedor ADO.NET não estiver registrado da maneira normal, porque o DbProviderFactory está sendo resolvido pelo EF, em seguida, também será necessário resolver esse serviço.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-271">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="a2f7a-272">Observe que um resolvedor para esse serviço é adicionado automaticamente ao usar o método DbConfiguration.SetProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-272">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="a2f7a-273">Conforme descrito na _visão geral de tipos de provedor_ seção acima, o IDbProviderFactoryResolver é usado para obter o DbProviderFactory correto de um determinado objeto DbConnection.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-273">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="a2f7a-274">A implementação padrão desse serviço quando em execução no .NET 4 usa o registro do provedor ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-274">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="a2f7a-275">Isso significa que se o provedor ADO.NET não estiver registrado da maneira normal, porque o DbProviderFactory está sendo resolvido pelo EF, em seguida, também será necessário resolver esse serviço.</span><span class="sxs-lookup"><span data-stu-id="a2f7a-275">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
