---
title: Migrações do Code First em ambientes de equipe - EF6
author: divega
ms.date: 2016-10-23
ms.assetid: 4c2d9a95-de6f-4e97-9738-c1f8043eff69
ms.openlocfilehash: 31f8476c64d36d4d1cf3d18deb59ebc482dcc975
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251226"
---
# <a name="code-first-migrations-in-team-environments"></a><span data-ttu-id="b49d9-102">Migrações do Code First em ambientes de equipe</span><span class="sxs-lookup"><span data-stu-id="b49d9-102">Code First Migrations in Team Environments</span></span>
> [!NOTE]
> <span data-ttu-id="b49d9-103">Este artigo pressupõe que você sabe como usar as migrações Code First em cenários básicos.</span><span class="sxs-lookup"><span data-stu-id="b49d9-103">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="b49d9-104">Se você não fizer isso, você precisará ler [migrações do Code First](~/ef6/modeling/code-first/migrations/index.md) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="b49d9-104">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="grab-a-coffee-you-need-to-read-this-whole-article"></a><span data-ttu-id="b49d9-105">Tomar um café, você precisa ler este artigo inteiro</span><span class="sxs-lookup"><span data-stu-id="b49d9-105">Grab a coffee, you need to read this whole article</span></span>

<span data-ttu-id="b49d9-106">Os problemas em ambientes de equipe são principalmente em torno de mesclagem migrações quando dois desenvolvedores geraram migrações em sua base de código local.</span><span class="sxs-lookup"><span data-stu-id="b49d9-106">The issues in team environments are mostly around merging migrations when two developers have generated migrations in their local code base.</span></span> <span data-ttu-id="b49d9-107">Enquanto as etapas para superar esses são bastante simples, eles exigem que você tenha uma compreensão sólida do funcionamento de migrações.</span><span class="sxs-lookup"><span data-stu-id="b49d9-107">While the steps to solve these are pretty simple, they require you to have a solid understanding of how migrations works.</span></span> <span data-ttu-id="b49d9-108">Por favor, não apenas pular para o final – Reserve um tempo para ler o artigo inteiro para garantir que você tiver êxito.</span><span class="sxs-lookup"><span data-stu-id="b49d9-108">Please don’t just skip ahead to the end – take the time to read the whole article to ensure you are successful.</span></span>

## <a name="some-general-guidelines"></a><span data-ttu-id="b49d9-109">Algumas diretrizes gerais</span><span class="sxs-lookup"><span data-stu-id="b49d9-109">Some general guidelines</span></span>

<span data-ttu-id="b49d9-110">Antes de nos aprofundar em como gerenciar as migrações de mesclagem geradas por vários desenvolvedores, aqui estão algumas diretrizes gerais para prepará-lo sucesso.</span><span class="sxs-lookup"><span data-stu-id="b49d9-110">Before we dig into how to manage merging migrations generated by multiple developers, here are some general guidelines to set you up for success.</span></span>

### <a name="each-team-member-should-have-a-local-development-database"></a><span data-ttu-id="b49d9-111">Cada membro da equipe deve ter um banco de dados de desenvolvimento local</span><span class="sxs-lookup"><span data-stu-id="b49d9-111">Each team member should have a local development database</span></span>

<span data-ttu-id="b49d9-112">As migrações usa o  **\_ \_MigrationsHistory** tabela para armazenar a quais migrações foram aplicadas ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-112">Migrations uses the **\_\_MigrationsHistory** table to store what migrations have been applied to the database.</span></span> <span data-ttu-id="b49d9-113">Se você tiver vários desenvolvedores gerar migrações diferentes ao tentar o mesmo banco de dados de destino (e, portanto, compartilham uma  **\_ \_MigrationsHistory** tabela) migrações vai ficar muito confuso.</span><span class="sxs-lookup"><span data-stu-id="b49d9-113">If you have multiple developers generating different migrations while trying to target the same database (and thus share a **\_\_MigrationsHistory** table) migrations is going to get very confused.</span></span>

<span data-ttu-id="b49d9-114">É claro que, se você tiver os membros da equipe que não estão gerando as migrações, há sem problemas fazendo com que eles compartilham um banco de dados de desenvolvimento central.</span><span class="sxs-lookup"><span data-stu-id="b49d9-114">Of course, if you have team members that aren’t generating migrations, there is no problem having them share a central development database.</span></span>

### <a name="avoid-automatic-migrations"></a><span data-ttu-id="b49d9-115">Evitar migrações automáticas</span><span class="sxs-lookup"><span data-stu-id="b49d9-115">Avoid automatic migrations</span></span>

<span data-ttu-id="b49d9-116">O resultado final é que as migrações automáticas inicialmente boas aparência em ambientes de equipe, mas na verdade eles simplesmente não funcionam.</span><span class="sxs-lookup"><span data-stu-id="b49d9-116">The bottom line is that automatic migrations initially look good in team environments, but in reality they just don’t work.</span></span> <span data-ttu-id="b49d9-117">Se você quiser saber o porquê, continue lendo – caso contrário, em seguida, pule para a próxima seção.</span><span class="sxs-lookup"><span data-stu-id="b49d9-117">If you want to know why, keep reading – if not, then you can skip to the next section.</span></span>

<span data-ttu-id="b49d9-118">As migrações automáticas permite que você tenha seu esquema de banco de dados atualizada de acordo com o modelo atual sem a necessidade de gerar arquivos de código (as migrações baseadas em código).</span><span class="sxs-lookup"><span data-stu-id="b49d9-118">Automatic migrations allows you to have your database schema updated to match the current model without the need to generate code files (code-based migrations).</span></span> <span data-ttu-id="b49d9-119">As migrações automáticas funcionaria muito bem em um ambiente de equipe, se você apenas os utilizou e nunca gerado as migrações baseadas em código.</span><span class="sxs-lookup"><span data-stu-id="b49d9-119">Automatic migrations would work very well in a team environment if you only ever used them and never generated any code-based migrations.</span></span> <span data-ttu-id="b49d9-120">O problema é que as migrações automáticas são limitadas e não lidar com um número de operações – renomeia propriedade/coluna, movimentação de dados para outra tabela, etc. Para tratar desses cenários, você acaba gerando as migrações baseadas em código (e editando o código gerado por scaffolding) que são misturados entre as alterações que são manipuladas pelo migrações automáticas.</span><span class="sxs-lookup"><span data-stu-id="b49d9-120">The problem is that automatic migrations are limited and don’t handle a number of operations – property/column renames, moving data to another table, etc. To handle these scenarios you end up generating code-based migrations (and editing the scaffolded code) that are mixed in between changes that are handled by automatic migrations.</span></span> <span data-ttu-id="b49d9-121">Isso é quase impossível para mesclar as alterações quando dois desenvolvedores fazer check-in migrações.</span><span class="sxs-lookup"><span data-stu-id="b49d9-121">This makes it near on impossible to merge changes when two developers check in migrations.</span></span>

## <a name="screencasts"></a><span data-ttu-id="b49d9-122">Screencasts</span><span class="sxs-lookup"><span data-stu-id="b49d9-122">Screencasts</span></span>

<span data-ttu-id="b49d9-123">Se, em vez disso, você teria assistir um screencast que leia este artigo, os vídeos a seguir abrangem o mesmo conteúdo deste artigo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-123">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="b49d9-124">Vídeo 1: "Migrações – nos bastidores"</span><span class="sxs-lookup"><span data-stu-id="b49d9-124">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="b49d9-125">[Neste screencast](http://channel9.msdn.com/blogs/ef/migrations-under-the-hood) aborda como controla as migrações e usa as informações sobre o modelo para detectar alterações no modelo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-125">[This screencast](http://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---team-environments"></a><span data-ttu-id="b49d9-126">Vídeo 2: "Migrações – ambientes de equipe"</span><span class="sxs-lookup"><span data-stu-id="b49d9-126">Video Two: "Migrations - Team Environments"</span></span>

<span data-ttu-id="b49d9-127">Aproveitando os conceitos de vídeo anterior, [este screencast](http://channel9.msdn.com/blogs/ef/migrations-team-environments) aborda os problemas que surgem em um ambiente de equipe e como resolvê-los.</span><span class="sxs-lookup"><span data-stu-id="b49d9-127">Building on the concepts from the previous video, [this screencast](http://channel9.msdn.com/blogs/ef/migrations-team-environments) covers the issues that arise in a team environment and how to solve them.</span></span>

## <a name="understanding-how-migrations-works"></a><span data-ttu-id="b49d9-128">Compreender como funciona a migrações</span><span class="sxs-lookup"><span data-stu-id="b49d9-128">Understanding how migrations works</span></span>

<span data-ttu-id="b49d9-129">A chave para usar com êxito as migrações em um ambiente de equipe é básico Noções básicas sobre como as migrações acompanha e usa informações sobre o modelo para detectar alterações no modelo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-129">The key to successfully using migrations in a team environment is a basic understanding how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="the-first-migration"></a><span data-ttu-id="b49d9-130">A primeira migração</span><span class="sxs-lookup"><span data-stu-id="b49d9-130">The first migration</span></span>

<span data-ttu-id="b49d9-131">Quando você adiciona a primeira migração ao seu projeto, executar algo como **Add-Migration primeiro** no Console do Gerenciador de pacotes.</span><span class="sxs-lookup"><span data-stu-id="b49d9-131">When you add the first migration to your project, you run something like **Add-Migration First** in Package Manager Console.</span></span> <span data-ttu-id="b49d9-132">As etapas de alto níveis que executa esse comando são mostradas abaixo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-132">The high level steps that this command performs are pictured below.</span></span>

![Primeira migração](~/ef6/media/firstmigration.png)

<span data-ttu-id="b49d9-134">O modelo atual é calculado a partir do código (1).</span><span class="sxs-lookup"><span data-stu-id="b49d9-134">The current model is calculated from your code (1).</span></span> <span data-ttu-id="b49d9-135">Os objetos de banco de dados necessários, em seguida, são calculados pelo diferem de modelo (2) – como essa é a primeira migração modelo diferem apenas usa um modelo vazio para a comparação.</span><span class="sxs-lookup"><span data-stu-id="b49d9-135">The required database objects are then calculated by the model differ (2) – since this is the first migration the model differ just uses an empty model for the comparison.</span></span> <span data-ttu-id="b49d9-136">As alterações necessárias são passadas para o gerador de código para compilar o código de migração necessárias (3), que é então adicionado à sua solução do Visual Studio (4).</span><span class="sxs-lookup"><span data-stu-id="b49d9-136">The required changes are passed to the code generator to build the required migration code (3) which is then added to your Visual Studio solution (4).</span></span>

<span data-ttu-id="b49d9-137">Além do código de migração real é armazenado no arquivo de código principal, as migrações também gera alguns arquivos de code-behind adicionais.</span><span class="sxs-lookup"><span data-stu-id="b49d9-137">In addition to the actual migration code that is stored in the main code file, migrations also generates some additional code-behind files.</span></span> <span data-ttu-id="b49d9-138">Esses arquivos são metadados que são usados pelas migrações e não são algo que você deve editar.</span><span class="sxs-lookup"><span data-stu-id="b49d9-138">These files are metadata that is used by migrations and are not something you should edit.</span></span> <span data-ttu-id="b49d9-139">Um desses arquivos é um arquivo de recurso (. resx) que contém um instantâneo do modelo no momento em que a migração foi gerada.</span><span class="sxs-lookup"><span data-stu-id="b49d9-139">One of these files is a resource file (.resx) that contains a snapshot of the model at the time the migration was generated.</span></span> <span data-ttu-id="b49d9-140">Você verá como isso é usado na próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="b49d9-140">You’ll see how this is used in the next step.</span></span>

<span data-ttu-id="b49d9-141">Neste ponto, você provavelmente executaria **Update-Database** para aplicar suas alterações no banco de dados e, em seguida, vá sobre a implementação de outras áreas do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-141">At this point you would probably run **Update-Database** to apply your changes to the database, and then go about implementing other areas of your application.</span></span>

### <a name="subsequent-migrations"></a><span data-ttu-id="b49d9-142">Migrações subsequentes</span><span class="sxs-lookup"><span data-stu-id="b49d9-142">Subsequent migrations</span></span>

<span data-ttu-id="b49d9-143">Posteriormente, voltar e fazer algumas alterações ao seu modelo – em nosso exemplo, adicionaremos uma **Url** propriedade **Blog**.</span><span class="sxs-lookup"><span data-stu-id="b49d9-143">Later you come back and make some changes to your model – in our example we’ll add a **Url** property to **Blog**.</span></span> <span data-ttu-id="b49d9-144">Você poderia, em seguida, emitir um comando, como **Add-Migration AddUrl** para criar o scaffolding de uma migração para o banco de dados correspondente de aplicar as alterações.</span><span class="sxs-lookup"><span data-stu-id="b49d9-144">You would then issue a command such as **Add-Migration AddUrl** to scaffold a migration to apply the corresponding database changes.</span></span> <span data-ttu-id="b49d9-145">As etapas de alto níveis que executa esse comando são mostradas abaixo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-145">The high level steps that this command performs are pictured below.</span></span>

![Segunda migração](~/ef6/media/secondmigration.png)

<span data-ttu-id="b49d9-147">Assim como a última vez, o modelo atual é calculado a partir de código (1).</span><span class="sxs-lookup"><span data-stu-id="b49d9-147">Just like last time, the current model is calculated from code (1).</span></span> <span data-ttu-id="b49d9-148">No entanto, desta vez há migrações existentes para que o modelo anterior é recuperado da migração (2) mais recente.</span><span class="sxs-lookup"><span data-stu-id="b49d9-148">However, this time there are existing migrations so the previous model is retrieved from the latest migration (2).</span></span> <span data-ttu-id="b49d9-149">Esses dois modelos são foi comparado para localizar as alterações de banco de dados necessário (3) e, em seguida, o processo for concluído como antes.</span><span class="sxs-lookup"><span data-stu-id="b49d9-149">These two models are diffed to find the required database changes (3) and then the process completes as before.</span></span>

<span data-ttu-id="b49d9-150">Esse mesmo processo é usado para as migrações adicionais que você adiciona ao projeto.</span><span class="sxs-lookup"><span data-stu-id="b49d9-150">This same process is used for any further migrations that you add to the project.</span></span>

### <a name="why-bother-with-the-model-snapshot"></a><span data-ttu-id="b49d9-151">Por que se preocupar com o instantâneo do modelo?</span><span class="sxs-lookup"><span data-stu-id="b49d9-151">Why bother with the model snapshot?</span></span>

<span data-ttu-id="b49d9-152">Você pode estar se perguntando por que o EF incomoda muito com o instantâneo do modelo – por que não simplesmente olhar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-152">You may be wondering why EF bothers with the model snapshot – why not just look at the database.</span></span> <span data-ttu-id="b49d9-153">Nesse caso, continue lendo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-153">If so, read on.</span></span> <span data-ttu-id="b49d9-154">Se você não estiver interessado, em seguida, você pode ignorar esta seção.</span><span class="sxs-lookup"><span data-stu-id="b49d9-154">If you’re not interested then you can skip this section.</span></span>

<span data-ttu-id="b49d9-155">Há inúmeros motivos que EF mantém o instantâneo em torno do modelo:</span><span class="sxs-lookup"><span data-stu-id="b49d9-155">There are a number of reasons EF keeps the model snapshot around:</span></span>

-   <span data-ttu-id="b49d9-156">Ele permite que seu banco de dados incorretos do modelo de EF.</span><span class="sxs-lookup"><span data-stu-id="b49d9-156">It allows your database to drift from the EF model.</span></span> <span data-ttu-id="b49d9-157">Essas alterações podem ser feitas diretamente no banco de dados, ou você pode alterar o código gerado por scaffolding em suas migrações para fazer as alterações.</span><span class="sxs-lookup"><span data-stu-id="b49d9-157">These changes can be made directly in the database, or you can change the scaffolded code in your migrations to make the changes.</span></span> <span data-ttu-id="b49d9-158">Aqui estão alguns exemplos na prática:</span><span class="sxs-lookup"><span data-stu-id="b49d9-158">Here are a couple of examples of this in practice:</span></span>
    -   <span data-ttu-id="b49d9-159">Você deseja adicionar um Inserted e atualizada a coluna a um ou mais de suas tabelas, mas você não deseja incluir essas colunas no modelo do EF.</span><span class="sxs-lookup"><span data-stu-id="b49d9-159">You want to add an Inserted and Updated to column to one or more of your tables but you don’t want to include these columns in the EF model.</span></span> <span data-ttu-id="b49d9-160">Se as migrações examinou o banco de dados que ele continuamente tentar descartar essas colunas sempre gerada por scaffolding uma migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-160">If migrations looked at the database it would continually try to drop these columns every time you scaffolded a migration.</span></span> <span data-ttu-id="b49d9-161">Usando o modelo de instantâneo, EF só irá detectar alterações legítimas para o modelo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-161">Using the model snapshot, EF will only ever detect legitimate changes to the model.</span></span>
    -   <span data-ttu-id="b49d9-162">Você deseja alterar o corpo de um procedimento armazenado usado para atualizações para incluir algum registro em log.</span><span class="sxs-lookup"><span data-stu-id="b49d9-162">You want to change the body of a stored procedure used for updates to include some logging.</span></span> <span data-ttu-id="b49d9-163">Se as migrações observou esse procedimento armazenado do banco de dados ele seria continuamente tente e redefini-la de volta para a definição de espera do EF.</span><span class="sxs-lookup"><span data-stu-id="b49d9-163">If migrations looked at this stored procedure from the database it would continually try and reset it back to the definition that EF expects.</span></span> <span data-ttu-id="b49d9-164">Ao usar o instantâneo do modelo, o EF só irá dar suporte código para alterar o procedimento armazenado, quando você altera a forma do procedimento no modelo do EF.</span><span class="sxs-lookup"><span data-stu-id="b49d9-164">By using the model snapshot, EF will only ever scaffold code to alter the stored procedure when you change the shape of the procedure in the EF model.</span></span>
    -   <span data-ttu-id="b49d9-165">Esses mesmos princípios se aplicam a adição de índices adicionais, incluindo as tabelas adicionais no banco de dados, mapeando o EF para uma exibição de banco de dados que se encontra em uma tabela, etc.</span><span class="sxs-lookup"><span data-stu-id="b49d9-165">These same principles apply to adding extra indexes, including extra tables in your database, mapping EF to a database view that sits over a table, etc.</span></span>
-   <span data-ttu-id="b49d9-166">O modelo do EF contém mais do que apenas a forma do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-166">The EF model contains more than just the shape of the database.</span></span> <span data-ttu-id="b49d9-167">Todo o modelo permite que as migrações, examine informações sobre as propriedades e classes no seu modelo e como eles são mapeados para as tabelas e colunas.</span><span class="sxs-lookup"><span data-stu-id="b49d9-167">Having the entire model allows migrations to look at information about the properties and classes in your model and how they map to the columns and tables.</span></span> <span data-ttu-id="b49d9-168">Essas informações permitem que as migrações ser mais inteligente no código que ele usa o Scaffold.</span><span class="sxs-lookup"><span data-stu-id="b49d9-168">This information allows migrations to be more intelligent in the code that it scaffolds.</span></span> <span data-ttu-id="b49d9-169">Por exemplo, se você alterar o nome da coluna que uma propriedade é mapeada para migrações pode detectar a renomeação por ver que é a mesma propriedade – algo que não pode ser feito se você tiver apenas o esquema de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-169">For example, if you change the name of the column that a property maps to migrations can detect the rename by seeing that it’s the same property – something that can’t be done if you only have the database schema.</span></span> 

## <a name="what-causes-issues-in-team-environments"></a><span data-ttu-id="b49d9-170">O que causa problemas em ambientes de equipe</span><span class="sxs-lookup"><span data-stu-id="b49d9-170">What causes issues in team environments</span></span>

<span data-ttu-id="b49d9-171">O fluxo de trabalho é abordado em funciona a seção anterior muito bem quando você for um único desenvolvedor trabalhando em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-171">The workflow covered in the previous section works great when you are a single developer working on an application.</span></span> <span data-ttu-id="b49d9-172">Ele também funciona bem em um ambiente de equipe se você for a única pessoa que fazer alterações no modelo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-172">It also works well in a team environment if you are the only person making changes to the model.</span></span> <span data-ttu-id="b49d9-173">Nesse cenário, você pode fazer alterações no modelo, gerar migrações e enviá-los para o controle de origem.</span><span class="sxs-lookup"><span data-stu-id="b49d9-173">In this scenario you can make model changes, generate migrations and submit them to your source control.</span></span> <span data-ttu-id="b49d9-174">Outros desenvolvedores podem sincronizar suas alterações e executar **Update-Database** as alterações de esquema aplicado.</span><span class="sxs-lookup"><span data-stu-id="b49d9-174">Other developers can sync your changes and run **Update-Database** to have the schema changes applied.</span></span>

<span data-ttu-id="b49d9-175">Problemas começam a surgir quando você tiver vários desenvolvedores possam fazer alterações no modelo do EF e enviando ao controle de origem ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-175">Issues start to arise when you have multiple developers making changes to the EF model and submitting to source control at the same time.</span></span> <span data-ttu-id="b49d9-176">Não tem o EF é uma maneira de primeira classe para mesclar suas migrações locais com as migrações que outro desenvolvedor enviado ao controle de origem, pois sincronizado pela última vez.</span><span class="sxs-lookup"><span data-stu-id="b49d9-176">What EF lacks is a first class way to merge your local migrations with migrations that another developer has submitted to source control since you last synced.</span></span>

## <a name="an-example-of-a-merge-conflict"></a><span data-ttu-id="b49d9-177">Um exemplo de um conflito de mesclagem</span><span class="sxs-lookup"><span data-stu-id="b49d9-177">An example of a merge conflict</span></span>

<span data-ttu-id="b49d9-178">Primeiro vamos examinar um exemplo concreto de tal um conflito de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="b49d9-178">First let’s look at a concrete example of such a merge conflict.</span></span> <span data-ttu-id="b49d9-179">Continuaremos em com de exemplo que vimos anteriormente.</span><span class="sxs-lookup"><span data-stu-id="b49d9-179">We’ll continue on with the example we looked at earlier.</span></span> <span data-ttu-id="b49d9-180">Como uma partida aponte vamos supor que as alterações da seção anterior foram check-in pelo desenvolvedor do original.</span><span class="sxs-lookup"><span data-stu-id="b49d9-180">As a starting point let’s assume the changes from the previous section were checked in by the original developer.</span></span> <span data-ttu-id="b49d9-181">Vamos rastrear dois desenvolvedores conforme eles fazem alterações no código base.</span><span class="sxs-lookup"><span data-stu-id="b49d9-181">We’ll track two developers as they make changes to code base.</span></span>

<span data-ttu-id="b49d9-182">Vamos rastrear o modelo do EF e as migrações por meio de um número de alterações.</span><span class="sxs-lookup"><span data-stu-id="b49d9-182">We’ll track the EF model and the migrations thru a number of changes.</span></span> <span data-ttu-id="b49d9-183">Para um ponto de partida, ambos os desenvolvedores têm sincronizados com o repositório de controle de origem, conforme ilustrado no gráfico a seguir.</span><span class="sxs-lookup"><span data-stu-id="b49d9-183">For a starting point, both developers have synced to the source control repository, as depicted in the following graphic.</span></span>

![Ponto de partida](~/ef6/media/startingpoint.png)

<span data-ttu-id="b49d9-185">Developer \#1 e o desenvolvedor \#2 agora faz algumas alterações no modelo do EF no seu código local base.</span><span class="sxs-lookup"><span data-stu-id="b49d9-185">Developer \#1 and developer \#2 now makes some changes to the EF model in their local code base.</span></span> <span data-ttu-id="b49d9-186">Developer \#1 adiciona um **Rating** propriedade a ser **Blog** – e gera um **AddRating** migração para aplicar as alterações no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-186">Developer \#1 adds a **Rating** property to **Blog** – and generates an **AddRating** migration to apply the changes to the database.</span></span> <span data-ttu-id="b49d9-187">Developer \#2 adiciona uma **leitores** propriedade **Blog** – e gera correspondente **AddReaders** migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-187">Developer \#2 adds a **Readers** property to **Blog** – and generates the corresponding **AddReaders** migration.</span></span> <span data-ttu-id="b49d9-188">Execute os dois desenvolvedores **Update-Database**, para aplicar as alterações em seus bancos de dados locais e, em seguida, continuar a desenvolver o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-188">Both developers run **Update-Database**, to apply the changes to their local databases, and then continue developing the application.</span></span>

> [!NOTE]
> <span data-ttu-id="b49d9-189">As migrações são prefixadas com um carimbo de hora, portanto, nosso gráfico representa que a migração AddReaders do desenvolvedor \#2 vem após a migração AddRating de desenvolvedor \#1.</span><span class="sxs-lookup"><span data-stu-id="b49d9-189">Migrations are prefixed with a timestamp, so our graphic represents that the AddReaders migration from Developer \#2 comes after the AddRating migration from Developer \#1.</span></span> <span data-ttu-id="b49d9-190">Se developer \#1 ou \#2 não gerado a torna a primeira migração nenhuma diferença para os problemas de trabalhar em uma equipe ou o processo para mesclá-las que veremos na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="b49d9-190">Whether developer \#1 or \#2 generated the migration first makes no difference to the issues of working in a team, or the process for merging them that we’ll look at in the next section.</span></span>

![Alterações locais](~/ef6/media/localchanges.png)

<span data-ttu-id="b49d9-192">Ele é um dia de sorte para desenvolvedor \#1 conforme acontecem enviar suas alterações primeiro.</span><span class="sxs-lookup"><span data-stu-id="b49d9-192">It’s a lucky day for Developer \#1 as they happen to submit their changes first.</span></span> <span data-ttu-id="b49d9-193">Porque nenhuma outra pessoa fez check-in, pois eles sincronizados seu repositório, eles apenas podem enviar suas alterações sem executar qualquer mesclagem.</span><span class="sxs-lookup"><span data-stu-id="b49d9-193">Because no one else has checked in since they synced their repository, they can just submit their changes without performing any merging.</span></span>

![Enviar](~/ef6/media/submit.png)

<span data-ttu-id="b49d9-195">Agora é hora de desenvolvedor \#2 para enviar.</span><span class="sxs-lookup"><span data-stu-id="b49d9-195">Now it’s time for Developer \#2 to submit.</span></span> <span data-ttu-id="b49d9-196">Eles não tiveram tanta sorte.</span><span class="sxs-lookup"><span data-stu-id="b49d9-196">They aren’t so lucky.</span></span> <span data-ttu-id="b49d9-197">Porque alguém enviou as alterações, pois eles sincronizados, precisará puxar as alterações e mesclagem.</span><span class="sxs-lookup"><span data-stu-id="b49d9-197">Because someone else has submitted changes since they synced, they will need to pull down the changes and merge.</span></span> <span data-ttu-id="b49d9-198">O sistema de controle do código-fonte provavelmente será capaz de mesclar automaticamente as alterações no nível do código, pois são muito simples.</span><span class="sxs-lookup"><span data-stu-id="b49d9-198">The source control system will likely be able to automatically merge the changes at the code level since they are very simple.</span></span> <span data-ttu-id="b49d9-199">O estado do desenvolvedor \#2 local do repositório após a sincronização é ilustrada no gráfico a seguir.</span><span class="sxs-lookup"><span data-stu-id="b49d9-199">The state of Developer \#2’s local repository after syncing is depicted in the following graphic.</span></span> 

![Pull](~/ef6/media/pull.png)

<span data-ttu-id="b49d9-201">Neste estágio Developer \#2 podem executar **Update-Database** que irá detectar o novo **AddRating** migração (que não tenha sido aplicado ao desenvolvedor \#do 2 banco de dados) e aplicá-lo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-201">At this stage Developer \#2 can run **Update-Database** which will detect the new **AddRating** migration (which hasn’t been applied to Developer \#2’s database) and apply it.</span></span> <span data-ttu-id="b49d9-202">Agora o **Rating** coluna é adicionada à **Blogs** tabela e o banco de dados está em sincronia com o modelo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-202">Now the **Rating** column is added to the **Blogs** table and the database is in sync with the model.</span></span>

<span data-ttu-id="b49d9-203">No entanto, existem dois problemas:</span><span class="sxs-lookup"><span data-stu-id="b49d9-203">There are a couple of problems though:</span></span>

1.  <span data-ttu-id="b49d9-204">Embora **Update-Database** aplicará os **AddRating** migração também acionará um aviso: *não é possível atualizar o banco de dados de acordo com o modelo atual porque existem alterações pendentes e a migração automática está desabilitada...*</span><span class="sxs-lookup"><span data-stu-id="b49d9-204">Although **Update-Database** will apply the **AddRating** migration it will also raise a warning: *Unable to update database to match the current model because there are pending changes and automatic migration is disabled…*</span></span>
    <span data-ttu-id="b49d9-205">O problema é que o instantâneo do modelo é armazenado na última migração (**AddReader**) está faltando o **classificação** propriedade no **Blog** (desde que não faz parte do modelo de quando o migração foi gerada).</span><span class="sxs-lookup"><span data-stu-id="b49d9-205">The problem is that the model snapshot stored in the last migration (**AddReader**) is missing the **Rating** property on **Blog** (since it wasn’t part of the model when the migration was generated).</span></span> <span data-ttu-id="b49d9-206">Código primeiro detecta que o modelo em que a última migração não corresponde ao modelo atual e gera o aviso.</span><span class="sxs-lookup"><span data-stu-id="b49d9-206">Code First detects that the model in the last migration doesn’t match the current model and raises the warning.</span></span>
2.  <span data-ttu-id="b49d9-207">Executando o aplicativo pode resultar em uma InvalidOperationException informando que "*o modelo fazendo o contexto de 'BloggingContext' foi alterado desde que o banco de dados foi criado. Considere o uso de migrações do Code First para atualizar o banco de dados..."*</span><span class="sxs-lookup"><span data-stu-id="b49d9-207">Running the application would result in an InvalidOperationException stating that “*The model backing the 'BloggingContext' context has changed since the database was created. Consider using Code First Migrations to update the database…”*</span></span>
    <span data-ttu-id="b49d9-208">Novamente, o problema é que o instantâneo do modelo armazenado na última migração não corresponde ao modelo atual.</span><span class="sxs-lookup"><span data-stu-id="b49d9-208">Again, the problem is the model snapshot stored in the last migration doesn’t match the current model.</span></span>
3.  <span data-ttu-id="b49d9-209">Por fim, esperaríamos em execução **Add-Migration** agora geraria uma migração vazia (pois não há nenhuma alteração a ser aplicado ao banco de dados).</span><span class="sxs-lookup"><span data-stu-id="b49d9-209">Finally, we would expect running **Add-Migration** now would generate an empty migration (since there are no changes to apply to the database).</span></span> <span data-ttu-id="b49d9-210">Mas porque as migrações compara o modelo atual para aquela da última migração (que está faltando a **Rating** propriedade), na verdade, ele será scaffold outro **AddColumn** chamada para adicionar o **Rating** coluna.</span><span class="sxs-lookup"><span data-stu-id="b49d9-210">But because migrations compares the current model to the one from the last migration (which is missing the **Rating** property) it will actually scaffold another **AddColumn** call to add in the **Rating** column.</span></span> <span data-ttu-id="b49d9-211">Obviamente, essa migração falhar durante **Update-Database** porque o **classificação** coluna já existe.</span><span class="sxs-lookup"><span data-stu-id="b49d9-211">Of course, this migration would fail during **Update-Database** because the **Rating** column already exists.</span></span>

## <a name="resolving-the-merge-conflict"></a><span data-ttu-id="b49d9-212">Resolver o conflito de mesclagem</span><span class="sxs-lookup"><span data-stu-id="b49d9-212">Resolving the merge conflict</span></span>

<span data-ttu-id="b49d9-213">A boa notícia é que não é muito difícil lidar com a mesclagem manualmente – desde que você tenha uma compreensão do funcionamento de migrações.</span><span class="sxs-lookup"><span data-stu-id="b49d9-213">The good news is that it’s not too hard to deal with the merge manually – provided you have an understanding of how migrations works.</span></span> <span data-ttu-id="b49d9-214">Portanto, se você tiver ignorado em frente a esta seção...</span><span class="sxs-lookup"><span data-stu-id="b49d9-214">So if you’ve skipped ahead to this section…</span></span> <span data-ttu-id="b49d9-215">Desculpe, você precisa voltar e ler o restante do artigo primeiro!</span><span class="sxs-lookup"><span data-stu-id="b49d9-215">sorry, you need to go back and read the rest of the article first!</span></span>

<span data-ttu-id="b49d9-216">Há duas opções, é a maneira mais fácil gerar uma migração em branco que tem o modelo correto atual como um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-216">There are two options, the easiest is to generate a blank migration that has the correct current model as a snapshot.</span></span> <span data-ttu-id="b49d9-217">A segunda opção é atualizar o instantâneo da última migração para tem o formato de instantâneo do modelo.</span><span class="sxs-lookup"><span data-stu-id="b49d9-217">The second option is to update the snapshot in the last migration to have the correct model snapshot.</span></span> <span data-ttu-id="b49d9-218">A segunda opção é um pouco mais difícil e não pode ser usada em todos os cenários, mas também é mais limpa porque ela não envolve a adição de uma migração extra.</span><span class="sxs-lookup"><span data-stu-id="b49d9-218">The second option is a little harder and can’t be used in every scenario, but it’s also cleaner because it doesn’t involve adding an extra migration.</span></span>

### <a name="option-1-add-a-blank-merge-migration"></a><span data-ttu-id="b49d9-219">Opção 1: Adicionar uma migração em branco 'merge'</span><span class="sxs-lookup"><span data-stu-id="b49d9-219">Option 1: Add a blank ‘merge’ migration</span></span>

<span data-ttu-id="b49d9-220">Nessa opção nós geramos uma migração em branco exclusivamente para a finalidade de verificar se a migração mais recente tem o instantâneo do modelo correto armazenados nela.</span><span class="sxs-lookup"><span data-stu-id="b49d9-220">In this option we generate a blank migration solely for the purpose of making sure the latest migration has the correct model snapshot stored in it.</span></span>

<span data-ttu-id="b49d9-221">Essa opção pode ser usada independentemente de quem gerou a última migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-221">This option can be used regardless of who generated the last migration.</span></span> <span data-ttu-id="b49d9-222">No exemplo, vem acompanhando desenvolvedor \#2 é cuidar da mesclagem e que aconteceram gerar a última migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-222">In the example we’ve been following Developer \#2 is taking care of the merge and they happened to generate the last migration.</span></span> <span data-ttu-id="b49d9-223">Mas essas mesmas etapas podem ser usadas se desenvolvedor \#1 gerado a última migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-223">But these same steps can be used if Developer \#1 generated the last migration.</span></span> <span data-ttu-id="b49d9-224">As etapas também se aplicam se houver várias migrações envolvidos – apenas usamos dois para manter a simplicidade.</span><span class="sxs-lookup"><span data-stu-id="b49d9-224">The steps also apply if there are multiple migrations involved – we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="b49d9-225">O processo a seguir pode ser usado para essa abordagem, a partir do momento em que você perceba que você tem alterações que precisam ser sincronizados a partir do controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="b49d9-225">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="b49d9-226">Certifique-se de que as alterações do modelo pendentes em sua base de código local tem sido escritas para uma migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-226">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="b49d9-227">Essa etapa garante que você não perca quaisquer alterações legítimas quando chega o momento para gerar a migração em branco.</span><span class="sxs-lookup"><span data-stu-id="b49d9-227">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="b49d9-228">Sincronizar com o controle de origem.</span><span class="sxs-lookup"><span data-stu-id="b49d9-228">Sync with source control.</span></span>
3.  <span data-ttu-id="b49d9-229">Execute **Update-Database** para aplicar quaisquer migrações novo que outros desenvolvedores tem check-in.</span><span class="sxs-lookup"><span data-stu-id="b49d9-229">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="b49d9-230">\*\*
    *Observação: \* \* \* se você não obtém todos os avisos do comando Update-Database não havia nenhuma nova migração de outros desenvolvedores e não é necessário para executar qualquer ainda mais a mesclagem.*</span><span class="sxs-lookup"><span data-stu-id="b49d9-230">\*\*
*Note:\*\*\*\*if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="b49d9-231">Execute **Add-Migration &lt;escolher\_um\_nome&gt; – IgnoreChanges** (por exemplo, **Add-Migration mesclar – IgnoreChanges**).</span><span class="sxs-lookup"><span data-stu-id="b49d9-231">Run **Add-Migration &lt;pick\_a\_name&gt; –IgnoreChanges** (for example, **Add-Migration Merge –IgnoreChanges**).</span></span> <span data-ttu-id="b49d9-232">Isso gera uma migração com todos os metadados (incluindo um instantâneo do modelo atual), mas ignorará todas as alterações que ele detecta ao comparar os modelos atuais para o instantâneo nas migrações último (que significa que você obtenha um espaço em branco **backup** e **Para baixo** método).</span><span class="sxs-lookup"><span data-stu-id="b49d9-232">This generates a migration with all the metadata (including a snapshot of the current model) but will ignore any changes it detects when comparing the current model to the snapshot in the last migrations (meaning you get a blank **Up** and **Down** method).</span></span>
5.  <span data-ttu-id="b49d9-233">Continuar a desenvolver ou envie ao controle de origem (depois de executar seu testes de unidade é claro).</span><span class="sxs-lookup"><span data-stu-id="b49d9-233">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="b49d9-234">Aqui está o estado do desenvolvedor \#2 local do código base depois de usar essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="b49d9-234">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Migração de mesclagem](~/ef6/media/mergemigration.png)

### <a name="option-2-update-the-model-snapshot-in-the-last-migration"></a><span data-ttu-id="b49d9-236">Opção 2: Atualizar o instantâneo do modelo em que a última migração</span><span class="sxs-lookup"><span data-stu-id="b49d9-236">Option 2: Update the model snapshot in the last migration</span></span>

<span data-ttu-id="b49d9-237">Essa opção é muito semelhante à opção 1, mas remove a migração de em branco extras porque vamos encarar os fatos, quem quer arquivos de código extra em sua solução.</span><span class="sxs-lookup"><span data-stu-id="b49d9-237">This option is very similar to option 1 but removes the extra blank migration – because let’s face it, who wants extra code files in their solution.</span></span>

<span data-ttu-id="b49d9-238">**Essa abordagem só é viável se a última migração existe apenas na sua base de código local e ainda não foi enviada ao controle de origem (por exemplo, se a última migração foi gerada pelo usuário que está fazendo a mesclagem)**.</span><span class="sxs-lookup"><span data-stu-id="b49d9-238">**This approach is only feasible if the latest migration exists only in your local code base and has not yet been submitted to source control (for example, if the last migration was generated by the user doing the merge)**.</span></span> <span data-ttu-id="b49d9-239">Editar os metadados de migrações que outros desenvolvedores já aplicado ao seu banco de dados de desenvolvimento – ou até mesmo pior aplicado a um banco de dados de produção – pode resultar em efeitos colaterais inesperados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-239">Editing the metadata of migrations that other developers may have already applied to their development database – or even worse applied to a production database – can result in unexpected side effects.</span></span> <span data-ttu-id="b49d9-240">Durante o processo, vamos para reverter a última migração em nosso banco de dados local e aplique-o novamente com metadados atualizados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-240">During the process we’re going to roll back the last migration in our local database and re-apply it with updated metadata.</span></span>

<span data-ttu-id="b49d9-241">Enquanto a última migração precisa apenas ser no código local base não existem restrições para o número ou a ordem das migrações que continuar a ele.</span><span class="sxs-lookup"><span data-stu-id="b49d9-241">While the last migration needs to just be in the local code base there are no restrictions to the number or order of migrations that proceed it.</span></span> <span data-ttu-id="b49d9-242">Pode haver várias migrações de vários desenvolvedores diferentes e as mesmas etapas se aplicam – apenas usamos dois para manter a simplicidade.</span><span class="sxs-lookup"><span data-stu-id="b49d9-242">There can be multiple migrations from multiple different developers and the same steps apply– we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="b49d9-243">O processo a seguir pode ser usado para essa abordagem, a partir do momento em que você perceba que você tem alterações que precisam ser sincronizados a partir do controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="b49d9-243">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="b49d9-244">Certifique-se de que as alterações do modelo pendentes em sua base de código local tem sido escritas para uma migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-244">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="b49d9-245">Essa etapa garante que você não perca quaisquer alterações legítimas quando chega o momento para gerar a migração em branco.</span><span class="sxs-lookup"><span data-stu-id="b49d9-245">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="b49d9-246">Sincronizar com o controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="b49d9-246">Sync with the source control.</span></span>
3.  <span data-ttu-id="b49d9-247">Execute **Update-Database** para aplicar quaisquer migrações novo que outros desenvolvedores tem check-in.</span><span class="sxs-lookup"><span data-stu-id="b49d9-247">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="b49d9-248">\*\*
    *Observação: \* \* \* se você não obtém todos os avisos do comando Update-Database não havia nenhuma nova migração de outros desenvolvedores e não é necessário para executar qualquer ainda mais a mesclagem.*</span><span class="sxs-lookup"><span data-stu-id="b49d9-248">\*\*
*Note:\*\*\*\*if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="b49d9-249">Execute **Update-Database – TargetMigration &lt;segundo\_última\_migração&gt;**  (o exemplo estamos vem acompanhando, isso seria **Update-Database – TargetMigration AddRating**).</span><span class="sxs-lookup"><span data-stu-id="b49d9-249">Run **Update-Database –TargetMigration &lt;second\_last\_migration&gt;** (in the example we’ve been following this would be **Update-Database –TargetMigration AddRating**).</span></span> <span data-ttu-id="b49d9-250">Essa migração – efetivamente 'não aplicável' da última funções de banco de dados de volta para o estado do segundo a última migração do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-250">This roles the database back to the state of the second last migration – effectively ‘un-applying’ the last migration from the database.</span></span>
    <span data-ttu-id="b49d9-251">\*\*
    *Observação: \* \* \* esta etapa é necessária para torná-lo seguro editar os metadados da migração, pois os metadados também são armazenados na \_ \_MigrationsHistoryTable do banco de dados. É por isso você só deve usar essa opção se a última migração só estiver em sua base de código local. Se outros bancos de dados tinham a última migração aplicada você também teria revertê-las e aplicar novamente a última migração para atualizar os metadados.*</span><span class="sxs-lookup"><span data-stu-id="b49d9-251">\*\*
*Note:\*\*\*\*This step is required to make it safe to edit the metadata of the migration since the metadata is also stored in the \_\_MigrationsHistoryTable of the database. This is why you should only use this option if the last migration is only in your local code base. If other databases had the last migration applied you would also have to roll them back and re-apply the last migration to update the metadata.*</span></span> 
5.  <span data-ttu-id="b49d9-252">Execute **Add-Migration &lt;completa\_nome\_incluindo\_timestamp\_de\_última\_migração** &gt; (no exemplo podemos vem acompanhando isso seria algo como **Add-Migration 201311062215252\_AddReaders**).</span><span class="sxs-lookup"><span data-stu-id="b49d9-252">Run **Add-Migration &lt;full\_name\_including\_timestamp\_of\_last\_migration**&gt; (in the example we’ve been following this would be something like **Add-Migration 201311062215252\_AddReaders**).</span></span>
    <span data-ttu-id="b49d9-253">\*\*
    *Observação: \* \* \* você precisa incluir o carimbo de hora para que as migrações Saiba que você deseja editar a migração existente em vez de gerar automaticamente um novo.*</span><span class="sxs-lookup"><span data-stu-id="b49d9-253">\*\*
    *Note:\*\*\*\*You need to include the timestamp so that migrations knows you want to edit the existing migration rather than scaffolding a new one.*</span></span>
<span data-ttu-id="b49d9-254">Isso atualizará os metadados para a última migração coincidir com o modelo atual.</span><span class="sxs-lookup"><span data-stu-id="b49d9-254">This will update the metadata for the last migration to match the current model.</span></span> <span data-ttu-id="b49d9-255">Você obterá o seguinte aviso quando o comando for concluído, mas é exatamente o que você deseja.</span><span class="sxs-lookup"><span data-stu-id="b49d9-255">You’ll get the following warning when the command completes, but that’s exactly what you want.</span></span> <span data-ttu-id="b49d9-256">"*Somente o código de Designer para a migração ' 201311062215252\_'AddReaders foi gerado por scaffolding novamente. Para a migração de toda o scaffold novamente, use o parâmetro - Force. "*</span><span class="sxs-lookup"><span data-stu-id="b49d9-256">“*Only the Designer Code for migration '201311062215252\_AddReaders' was re-scaffolded. To re-scaffold the entire migration, use the -Force parameter.”*</span></span>
6.  <span data-ttu-id="b49d9-257">Execute **Update-Database** aplicar novamente a migração mais recente com os metadados atualizados.</span><span class="sxs-lookup"><span data-stu-id="b49d9-257">Run **Update-Database** to re-apply the latest migration with the updated metadata.</span></span>
7.  <span data-ttu-id="b49d9-258">Continuar a desenvolver ou envie ao controle de origem (depois de executar seu testes de unidade é claro).</span><span class="sxs-lookup"><span data-stu-id="b49d9-258">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="b49d9-259">Aqui está o estado do desenvolvedor \#2 local do código base depois de usar essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="b49d9-259">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Metadados atualizados](~/ef6/media/updatedmetadata.png)

## <a name="summary"></a><span data-ttu-id="b49d9-261">Resumo</span><span class="sxs-lookup"><span data-stu-id="b49d9-261">Summary</span></span>

<span data-ttu-id="b49d9-262">Há alguns desafios ao usar migrações do Code First em um ambiente de equipe.</span><span class="sxs-lookup"><span data-stu-id="b49d9-262">There are some challenges when using Code First Migrations in a team environment.</span></span> <span data-ttu-id="b49d9-263">No entanto, um entendimento básico de como funciona a migrações e algumas abordagens simples para resolver conflitos de mesclagem tornam fácil superar esses desafios.</span><span class="sxs-lookup"><span data-stu-id="b49d9-263">However, a basic understanding of how migrations works and some simple approaches for resolving merge conflicts make it easy to overcome these challenges.</span></span>

<span data-ttu-id="b49d9-264">O problema fundamental é incorreto metadados armazenados na migração mais recente.</span><span class="sxs-lookup"><span data-stu-id="b49d9-264">The fundamental issue is incorrect metadata stored in the latest migration.</span></span> <span data-ttu-id="b49d9-265">Isso faz com que o Code First para detectar incorretamente que o modelo atual e o esquema de banco de dados não coincidem e criar o scaffolding de um código incorreto na próxima migração.</span><span class="sxs-lookup"><span data-stu-id="b49d9-265">This causes Code First to incorrectly detect that the current model and database schema don’t match and to scaffold incorrect code in the next migration.</span></span> <span data-ttu-id="b49d9-266">Essa situação pode ser superada pela geração de uma migração em branco com o modelo correto ou atualizando os metadados na migração mais recente.</span><span class="sxs-lookup"><span data-stu-id="b49d9-266">This situation can be overcome by generating a blank migration with the correct model, or updating the metadata in the latest migration.</span></span>
